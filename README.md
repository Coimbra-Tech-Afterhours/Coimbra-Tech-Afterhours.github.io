# Coimbra Tech Afterhours

Landing page for the Coimbra Tech Afterhours community ‚Äî an after-work community bringing together people in tech, product, and startups in Coimbra, Portugal.

üåê **Live site**: [coimbratech.org](https://coimbratech.org)

## About

Coimbra Tech Afterhours is a local community connecting tech professionals and enthusiasts beyond working hours. Our goal is to create a regular space to exchange ideas, learn from real experiences, and strengthen Coimbra's tech ecosystem.

## Features

- üåç **Bilingual** (Portuguese/English) with language toggle
- üì± **Fully responsive** design optimized for mobile devices
- üé® **Modern UI** with clean design and smooth animations
- ‚ôø **Accessible** with semantic HTML and ARIA labels
- ‚ö° **Fast** static site with no build step required

## Tech Stack

- **HTML5** ‚Äî Semantic markup
- **CSS3** ‚Äî Custom styles with CSS variables
- **Vanilla JavaScript** ‚Äî Language switching and navigation
- **Node.js** ‚Äî Scripts for fetching events from Notion API
- **Notion API** ‚Äî Events database integration
- **GitHub Pages** ‚Äî Hosting

## Project Structure

```yaml
‚îú‚îÄ‚îÄ index.html                          # Main HTML file
‚îú‚îÄ‚îÄ styles.css                          # All styles
‚îú‚îÄ‚îÄ package.json                        # Node.js dependencies
‚îú‚îÄ‚îÄ scripts/                            # Node.js scripts
‚îÇ   ‚îî‚îÄ‚îÄ fetch-events-from-notion.mjs    # Script to fetch events from Notion
‚îú‚îÄ‚îÄ public/                             # Generated static files
‚îÇ   ‚îî‚îÄ‚îÄ events.json                     # Events data (generated by script)
‚îú‚îÄ‚îÄ img/                                # Images directory
‚îÇ   ‚îú‚îÄ‚îÄ logo.png                        # Logo image
‚îÇ   ‚îú‚îÄ‚îÄ logo.svg                        # Logo SVG
‚îÇ   ‚îú‚îÄ‚îÄ ricardo-vitorino.jpeg           # Organiser photo (Vitorino)
‚îÇ   ‚îî‚îÄ‚îÄ rui-chicoria.jpeg               # Organiser photo (Chic√≥ria)
‚îú‚îÄ‚îÄ favicon_io/                         # Favicon files
‚îî‚îÄ‚îÄ README.md                           # This file
```

## Development

### Local Development

1. Clone the repository:

    ```bash
    git clone https://github.com/Coimbra-Tech-Afterhours/Coimbra-Tech-Afterhours.github.io.git
    cd Coimbra-Tech-Afterhours.github.io
    ```

2. Install dependencies (if using the Notion events feature):

    ```bash
    npm install
    ```

3. Fetch events from Notion (optional):

    Create a `.env` file in the root directory with your Notion credentials:

    ```env
    NOTION_API_KEY=your_notion_api_key_here
    NOTION_EVENTS_DATABASE_ID=your_database_id_here
    ```

    Then run the script to fetch events:

    ```bash
    npm run fetch-events
    ```

    This will create/update `public/events.json` with events from your Notion database.

4. Serve locally using Python:

    ```bash
    python -m http.server 8000
    ```

5. Open in browser:

    ```bash
    http://localhost:8000
    ```

### Fetching Events from Notion

The site can display events from a Notion database. To set this up:

1. **Create a Notion Integration:**
   - Go to <https://www.notion.so/my-integrations>
   - Create a new integration
   - Copy the API key

2. **Set up your Events Database:**
   - Create a database in Notion with the following properties:
     - `Name` (Title)
     - `Date` (Date)
     - `Type` (Select: Afterhours/Partner Event/Workshop)
     - `Visible on site` (Checkbox)
     - `Status` (Status: Past/Upcoming/Draft)
     - `Link` (URL - optional, for event registration/details)
     - `Language` (Multi-select - optional, e.g., PT, EN)
   - Share the database with your integration **with edit access** (required for automatic Status updates)
   - Copy the database ID from the URL
   - **Note:** Location/venue information is not displayed on the site (provided in event details pages instead)
   - **Automatic Status Updates:** The GitHub Action automatically updates Status from "Upcoming" to "Past" when event dates pass (replaces Notion automation for free plan users)

3. **Run the fetch script:**

   ```bash
   # Set environment variables
   export NOTION_API_KEY="your_api_key"
   export NOTION_EVENTS_DATABASE_ID="your_database_id"
   
   # Or use a .env file (recommended)
   # Create .env file with the variables above
   
   # Run the script
   npm run fetch-events
   ```

4. **Verify the output:**
   - Check that `public/events.json` was created
   - Open the site locally and verify events are displayed

**Note:** The `.env` file is gitignored and should never be committed. The Notion API key should only be used in the Node script, never exposed to the frontend.

### Events Data (Notion ‚Üí GitHub Pages)

The site displays events from a Notion database that are automatically synced to `public/events.json` via a GitHub Actions workflow.

#### Data Flow

1. **Notion Database** ‚Üí Events are managed in a Notion database with properties like `Name`, `Date`, `Status`, `Type`, `Link`, `Language`, etc.
2. **GitHub Action (Sync)** ‚Üí Runs hourly (UTC), daily at midnight (UTC), and on manual trigger to:
   - Automatically update Status from "Upcoming" to "Past" when event dates pass (replaces Notion automation)
   - Fetch events from Notion API
   - Exclude Place data (Place Name, Place Link) for security (secret locations)
3. **Static JSON** ‚Üí Events are written to `public/events.json` and committed to the repository
4. **GitHub Action (Deploy)** ‚Üí Automatically triggered after sync completes to deploy updated content to GitHub Pages
5. **Frontend** ‚Üí The homepage and `/events` page fetch and render events from the JSON file

#### GitHub Actions Workflows

The repository uses three GitHub Actions workflows:

1. **`sync-notion.yml`** ‚Äî Syncs events from Notion
   - Runs hourly (UTC) and daily at midnight (UTC) via cron schedule
   - Can be triggered manually via `workflow_dispatch`
   - Automatically updates Status in Notion (Upcoming ‚Üí Past) when event dates pass
   - Fetches events from Notion API
   - Excludes Place data (Place Name, Place Link) for security
   - Commits changes to `public/events.json`
   - Automatically triggers deployment workflow

2. **`static.yml`** ‚Äî Deploys to GitHub Pages
   - Triggers on pushes to `main` branch
   - Also triggers automatically after `sync-notion.yml` completes (via `workflow_run`)
   - Deploys entire repository to GitHub Pages

3. **`sitemap.yml`** ‚Äî Updates sitemap
   - Triggers when HTML files or `public/events.json` change
   - Ensures `sitemap.xml` exists and is up to date

#### Running Locally

To test the events functionality locally:

1. **Ensure events.json exists:**

   ```bash
   # Option 1: Run the fetch script (requires Notion credentials)
   npm run fetch-events
   
   # Option 2: Copy an existing events.json if available
   ```

2. **Serve locally:**

   ```bash
   python -m http.server 8000
   # or
   npx http-server -p 8000
   ```

3. **View the site:**
   - Homepage: `http://localhost:8000/` - Shows upcoming events section
   - Events page: `http://localhost:8000/events.html` - Shows full events listing

#### JSON Structure

The `public/events.json` file contains an array of event objects with the following properties:

- `Name` (string) - Event name/title
- `Date` (string) - ISO 8601 date string
- `datePretty` (string) - Human-readable date (e.g., "6 Nov 2025 18:30")
- `Status` (string) - "Upcoming" or "Past" (automatically updated when dates pass)
- `Type` (string) - Event type (e.g., "Afterhours", "Partner Event")
- `Language` (array) - Array of language codes (e.g., ["PT", "EN"])
- `Link` (string, optional) - RSVP or details URL

**Note:** Place data (Place Name, Place Link) is **not** included in the JSON file for security reasons (secret locations). Location/venue information is provided on event details pages instead.

#### Customization

**Changing labels/texts (PT/EN):**

- Edit `assets/js/events.js` and modify the `i18n` object
- Update `data-i18n-pt` and `data-i18n-en` attributes in HTML

**Changing number of events on homepage:**

- Edit `assets/js/events.js` and modify the `CONFIG` object:

  ```javascript
  const CONFIG = {
    MAX_HOME_FEATURED: 1,  // Featured event count
    MAX_HOME_LIST: 2,       // List events count
  };
  ```

**Customizing card styles:**

- Edit `assets/css/events.css` to modify event card appearance
- All styles use CSS variables from `styles.css` for consistency

#### Security Notes

**API Keys:** Secrets (Notion API keys) are stored in GitHub Actions secrets and are **never** exposed to the frontend. The frontend only accesses the public `events.json` file, which contains no sensitive information.

**Place Data:** Place/location data (Place Name, Place Link) is excluded from the JSON file to protect secret locations. The fetch script explicitly excludes and deletes Place properties to ensure they never appear in the generated JSON, even if property names change.

#### Events UI

The events UI is implemented in `/assets/js/events.js` and `/assets/css/events.css`. The UI is data-driven from `/public/events.json` (generated hourly via GitHub Action).

**How it works:**

- **Homepage (`#events` section):** Shows 1 featured event (first upcoming) + up to 2 additional upcoming events
- **Events page (`/events.html`):** Shows all upcoming events in a responsive grid (1 column mobile, 2 columns ‚â•768px), plus past events grouped by year/month

**Customization:**

1. **Number of events on homepage:** Edit `CONFIG.MAX_HOME_FEATURED` and `CONFIG.MAX_HOME_LIST` in `events.js`

2. **Badge colors:** Edit CSS variables in `events.css`:

   ```css
   --events-accent: #39d3c2;   /* teal for Afterhours */
   --events-partner: #7a6ff0;  /* violet for Partner Event */
   ```

3. **Grid breakpoints:** Edit media queries in `events.css`:

   ```css
   @media (min-width: 768px) {
     .grid--events {
       grid-template-columns: repeat(2, 1fr);
     }
   }
   ```

4. **Card styling:** All card styles use CSS variables (`--events-surface`, `--events-border`, etc.) defined at the top of `events.css`

**Accessibility:**

- Event titles are clickable links when `Link` exists
- Whole card is clickable via overlay anchor (only when `Link` exists)
- Disabled "Coming soon" buttons use `aria-disabled="true"`
- All dates use semantic `<time datetime="ISO">` elements
- Keyboard focus styles on all interactive elements
- Icons have `aria-hidden="true"` (decorative)

**Empty states:**

- Shows skeleton shimmer while loading
- Friendly empty messages with PT/EN i18n support

#### Simple Events List

The events UI uses a simple, readable list format. Data flows from Notion ‚Üí GitHub Action ‚Üí `public/events.json` ‚Üí simple list UI.

**How it works:**

- **Homepage (`#events` section):** Shows up to 3 upcoming events in a simple list
- **Events page (`/events.html`):** Shows all upcoming events, plus past events grouped by year/month

**Customization:**

1. **Number of events on homepage:** Edit `MAX_HOME_EVENTS` constant in `events.js`:

   ```javascript
   const CONFIG = {
     MAX_HOME_EVENTS: 3,  // Change this number
   };
   ```

2. **Type badge colors:** Edit CSS variables in `events.css`:

   ```css
   --type-afterhours: #39d3c2;  /* Teal for Afterhours */
   --type-partner: #7768f8;      /* Violet for Partner Event */
   ```

3. **Languages display:** Languages are automatically shown if present in the data. To hide them, modify the template in `createEventRow()` to omit the languages span.

4. **Row spacing:** Adjust `.event-row` padding and gap values in `events.css`

5. **Mobile breakpoint:** Edit the media query at `@media (max-width: 720px)` to change when rows stack

**Security note:** No secrets are exposed on the frontend. The JSON file is public and generated hourly via GitHub Action.

### Deployment

The site is automatically deployed via GitHub Pages using the `static.yml` workflow. Deployment happens in two scenarios:

1. **Manual changes** ‚Äî Any push to the `main` branch automatically triggers deployment
2. **Automatic sync** ‚Äî When events are synced from Notion via `sync-notion.yml`, the deployment workflow is automatically triggered via `workflow_run` to ensure the website updates with the latest events

**Note:** The deployment workflow uses a dual-trigger approach (`push` + `workflow_run`) to ensure reliable deployment even when changes are made by GitHub Actions bots.

### Testing Workflows Locally

Before committing workflow changes, test them locally to avoid breaking the production site. Here are recommended testing approaches:

#### Method 1: Test Scripts Locally (Recommended - Safest)

Test the Node.js scripts that the workflows use:

```bash
# 1. Ensure you have a .env file with Notion credentials
# NOTION_API_KEY=your_key
# NOTION_EVENTS_DATABASE=your_database_id

# 2. Test the complete sync workflow locally
npm run test-sync

# This will:
# - Check if Notion database was updated
# - Fetch events if needed
# - Update public/events.json (locally, not committed)
# - Update .last-sync timestamp
```

**What this tests:**

- ‚úÖ Script logic and error handling
- ‚úÖ Notion API integration
- ‚úÖ JSON file generation
- ‚úÖ Skip logic when no updates needed

**What this doesn't test:**

- ‚ùå Git commit/push logic
- ‚ùå GitHub Actions workflow triggers
- ‚ùå Deployment workflow

#### Method 2: Test on a Feature Branch (Recommended - Most Realistic)

Test the full workflow on a separate branch:

```bash
# 1. Create a test branch
git checkout -b test/workflow-changes

# 2. Commit your workflow changes
git add .github/workflows/
git commit -m "test: workflow improvements"

# 3. Push to trigger workflows
git push origin test/workflow-changes

# 4. Monitor workflows in GitHub Actions tab
# - sync-notion.yml won't run (only runs on main)
# - static.yml won't deploy (only deploys main branch)
# - But you can manually trigger them to test
```

**Manual workflow testing:**

1. Go to **Actions** tab in GitHub
2. Select the workflow (e.g., "Sync from Notion")
3. Click **Run workflow** ‚Üí Select your test branch ‚Üí **Run workflow**
4. Monitor the execution and check logs

**What this tests:**

- ‚úÖ Full GitHub Actions workflow execution
- ‚úÖ All workflow steps including git operations
- ‚úÖ Workflow triggers and conditions
- ‚úÖ Error handling in real environment

**Safety:** Since workflows are configured to only deploy from `main`, testing on a feature branch is safe.

#### Method 3: Validate Workflow Syntax

Check workflow YAML syntax before committing:

```bash
# Option A: Use GitHub's actionlint (if installed)
actionlint .github/workflows/*.yml

# Option B: Use yamllint
yamllint .github/workflows/*.yml

# Option C: Use online validator
# Copy workflow YAML to: https://github.com/rhysd/actionlint
```

#### Method 4: Test Workflow Logic with Act (Advanced)

Use [`act`](https://github.com/nektos/act) to run GitHub Actions locally:

```bash
# Install act (macOS)
brew install act

# Test sync-notion workflow locally (dry-run, no push)
act workflow_dispatch -W .github/workflows/sync-notion.yml --dry-run

# Test with secrets (create .secrets file)
act workflow_dispatch -W .github/workflows/sync-notion.yml \
  --secret-file .secrets \
  --env NOTION_EVENTS_DATABASE=your_id
```

**Note:** `act` has limitations and may not perfectly replicate GitHub's environment, but it's useful for catching syntax errors and basic logic issues.

#### Recommended Testing Workflow

1. **Before committing:**

   ```bash
   # Test scripts locally
   npm run test-sync
   
   # Validate YAML syntax
   actionlint .github/workflows/*.yml  # if available
   ```

2. **After committing to feature branch:**

   ```bash
   # Push to test branch
   git push origin test/workflow-changes
   
   # Manually trigger workflow in GitHub UI
   # Monitor execution and logs
   ```

3. **Before merging to main:**

   - ‚úÖ All tests pass locally
   - ‚úÖ Workflow executes successfully on test branch
   - ‚úÖ No errors in workflow logs
   - ‚úÖ Verify workflow triggers work as expected

#### Quick Test Checklist

- [ ] Scripts run locally without errors (`npm run test-sync`)
- [ ] Commit logic works correctly (`npm run test-commit-logic`)
- [ ] Workflow YAML syntax is valid
- [ ] Workflow executes on test branch
- [ ] Git operations (commit/push) work correctly
- [ ] Workflow triggers (`workflow_run`) function properly
- [ ] Error handling works (test with invalid credentials)
- [ ] Conditional logic works (test skip scenarios)

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

This project is licensed under the MIT License ‚Äî see the [LICENSE](LICENSE) file for details.

## Contact

- **Email**: <afterhours@coimbratech.org>
- **GitHub**: [@Coimbra-Tech-Afterhours](https://github.com/Coimbra-Tech-Afterhours)

## SEO & Discovery

The site includes basic SEO optimizations for search engines and AI crawlers:

### robots.txt

Located at `/robots.txt`, this file:

- Allows all crawlers to access the site
- Explicitly allows major AI crawlers (GPTBot, Google-Extended, ClaudeBot, PerplexityBot)
- References the sitemap location

### sitemap.xml

Located at `/sitemap.xml`, this file lists **only on-site URLs**:

- `https://coimbratech.org/` (homepage)
- `https://coimbratech.org/events` (events page)

**Note:** External Notion links (Join and Code of Conduct) are **not** included in the sitemap, as they are external resources hosted on Notion.

### Structured Data (JSON-LD)

- **Homepage (`index.html`)**: Includes Organization JSON-LD with community name, URL, logo, social profiles, and location
- **Events page (`events.html`)**: Dynamically injects Event JSON-LD for all events from `public/events.json` using the `injectEventJsonLd()` function in `assets/js/events.js`

### Meta Tags

Both pages include:

- Unique `<title>` tags (‚â§60 characters)
- Meta descriptions (‚â§160 characters)
- Canonical URLs pointing to HTTPS versions
- Open Graph tags for social sharing
- Twitter Card tags

**Where to edit:**

- Titles/descriptions: Edit the `<title>` and `<meta name="description">` tags in `index.html` and `events.html`
- Canonical URLs: Edit the `<link rel="canonical">` tags in each HTML file
- Social card image: Update `og:image` and `twitter:image` meta tags to point to `/assets/social-card.png` (1200x630px recommended)

### External Links

External Notion links (Join and Code of Conduct) include:

- `target="_blank"` to open in new tabs
- `rel="noopener noreferrer external"` for security and SEO

### Next Steps

1. **Submit sitemap to Google Search Console:**
   - Add `https://coimbratech.org/sitemap.xml` in Google Search Console
   - Request indexing for `/` and `/events` pages

2. **Validate structured data:**
   - Use [Google Rich Results Test](https://search.google.com/test/rich-results) to validate Event JSON-LD on `/events`
   - Verify Organization JSON-LD on homepage

3. **Create social card image:**
   - Create a 1200x630px image at `/assets/social-card.png` for optimal social sharing

## Made in Coimbra, of course. üáµüáπ
